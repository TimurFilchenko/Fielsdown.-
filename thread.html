<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–°–æ–∑–¥–∞—Ç—å –¥–æ—Å–∫—É ‚Äî Fielsdown</title>
  <link rel="icon" href="/public/favicon.ico" />
  <style>
    /* =============================================================================
       THREAD.HTML ‚Äî –ü–û–õ–ù–ê–Ø –í–ï–†–°–ò–Ø
       –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ—Å–∫–∏ b/–Ω–∞–∑–≤–∞–Ω–∏–µ
       –í—Å—ë –≤–Ω—É—Ç—Ä–∏. –ù–∏–∫–∞–∫–∏—Ö –≤–Ω–µ—à–Ω–∏—Ö —Ñ–∞–π–ª–æ–≤.
       ============================================================================= */

    /* –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-primary: #ffffff;
      --bg-secondary: #fafafa;
      --bg-tertiary: #f5f5f5;
      --text-primary: #121212;
      --text-secondary: #666666;
      --text-muted: #999999;
      --accent: #0077ff;
      --accent-hover: #005fcc;
      --danger: #e53935;
      --success: #2e7d32;
      --border: #e0e0e0;
      --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      --card-radius: 16px;
      --input-radius: 10px;
      --transition-fast: all 0.18s cubic-bezier(0.33, 0, 0.67, 0.33);
      --transition-normal: all 0.24s cubic-bezier(0.33, 0, 0.67, 0.33);
    }

    body {
      background-color: var(--bg-primary);
      color: var(--text-primary);
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.6;
      font-feature-settings: "liga", "kern";
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 720px;
      margin: 0 auto;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 32px;
    }

    .logo {
      font-size: 24px;
      font-weight: 800;
      color: var(--accent);
    }

    .back-link {
      color: var(--accent);
      text-decoration: none;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .back-link:hover {
      text-decoration: underline;
    }

    .card {
      background: var(--bg-primary);
      border: 1px solid var(--border);
      border-radius: var(--card-radius);
      padding: 40px;
      box-shadow: var(--card-shadow);
    }

    .card-title {
      font-size: 28px;
      font-weight: 800;
      margin-bottom: 8px;
      color: var(--accent);
    }

    .card-subtitle {
      color: var(--text-muted);
      font-size: 16px;
      margin-bottom: 32px;
      line-height: 1.5;
    }

    .form-group {
      margin-bottom: 24px;
    }

    .form-group label {
      display: block;
      margin-bottom: 10px;
      font-weight: 600;
      font-size: 15px;
      color: var(--text-primary);
    }

    .form-control {
      width: 100%;
      padding: 14px 18px;
      border: 1px solid var(--border);
      border-radius: var(--input-radius);
      font-size: 16px;
      background: var(--bg-secondary);
      color: var(--text-primary);
      transition: var(--transition-normal);
      outline: none;
    }

    .form-control:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(0, 119, 255, 0.15);
    }

    .form-control::placeholder {
      color: var(--text-muted);
    }

    textarea.form-control {
      min-height: 120px;
      resize: vertical;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 14px 28px;
      border-radius: var(--input-radius);
      font-weight: 600;
      font-size: 16px;
      text-decoration: none;
      cursor: pointer;
      transition: var(--transition-normal);
      border: none;
      width: 100%;
    }

    .btn-primary {
      background: var(--accent);
      color: white;
    }

    .btn-primary:hover {
      background: var(--accent-hover);
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0, 119, 255, 0.25);
    }

    .error-message {
      color: var(--danger);
      font-size: 14px;
      margin-top: 8px;
      min-height: 20px;
      opacity: 0;
      transform: translateY(-4px);
      transition: var(--transition-fast);
    }

    .error-message.show {
      opacity: 1;
      transform: translateY(0);
    }

    .success-message {
      color: var(--success);
      font-size: 15px;
      margin-top: 12px;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .success-message.show {
      opacity: 1;
    }

    code {
      background: var(--bg-tertiary);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: monospace;
      font-size: 14px;
    }

    @media (max-width: 600px) {
      .card {
        padding: 32px 24px;
      }
      .card-title {
        font-size: 24px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">Fielsdown</div>
      <a href="/" class="back-link">‚Üê –í—Å–µ –¥–æ—Å–∫–∏</a>
    </header>

    <div class="card">
      <h1 class="card-title">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –¥–æ—Å–∫—É</h1>
      <p class="card-subtitle">
        –î–æ—Å–∫–∏ –≤ Fielsdown –æ–±–æ–∑–Ω–∞—á–∞—é—Ç—Å—è –ø—Ä–µ—Ñ–∏–∫—Å–æ–º <code>b/</code>.<br>
        –ù–∞–ø—Ä–∏–º–µ—Ä: <code>b/anime</code>, <code>b/games</code>, <code>b/kyrgyz_culture</code>.
      </p>

      <form id="createBoardForm">
        <div class="form-group">
          <label for="boardName">–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ—Å–∫–∏</label>
          <input
            type="text"
            id="boardName"
            class="form-control"
            placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω–∏—Ü–∞)"
            maxlength="32"
            autocomplete="off"
          />
          <div class="error-message" id="boardNameError"></div>
        </div>

        <div class="form-group">
          <label for="boardDescription">–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
          <textarea
            id="boardDescription"
            class="form-control"
            placeholder="–ö—Ä–∞—Ç–∫–æ –æ–ø–∏—à–∏—Ç–µ —Ç–µ–º—É –¥–æ—Å–∫–∏ (–¥–æ 200 —Å–∏–º–≤–æ–ª–æ–≤)"
            maxlength="200"
          ></textarea>
          <div class="error-message" id="boardDescriptionError"></div>
        </div>

        <button type="submit" class="btn btn-primary"> –°–æ–∑–¥–∞—Ç—å –¥–æ—Å–∫—É</button>
        <div class="success-message" id="successMessage"></div>
      </form>
    </div>
  </div>

  <script>
    /* =============================================================================
       –õ–û–ì–ò–ö–ê –°–û–ó–î–ê–ù–ò–Ø –î–û–°–ö–ò ‚Äî –ü–û–õ–ù–ê–Ø –í–ï–†–°–ò–Ø
       –†–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–Ω–æ–º–Ω–æ. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ localStorage.
       ============================================================================= */

    // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
    const STORAGE_KEY = 'fielsdown_boards_v1';

    // –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ—Å–æ–∫
    function getBoards() {
      try {
        const data = localStorage.getItem(STORAGE_KEY);
        return data ? JSON.parse(data) : [];
      } catch (e) {
        console.warn('–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –¥–æ—Å–æ–∫:', e);
        return [];
      }
    }

    // –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–æ—Å–æ–∫
    function saveBoards(boards) {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(boards));
      } catch (e) {
        console.error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–æ—Å–∫–∏:', e);
        alert('–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–æ—Å–∫—É. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ.');
      }
    }

    // –ü–æ–∫–∞–∑ –æ—à–∏–±–∫–∏
    function showError(elementId, message) {
      const errorEl = document.getElementById(elementId + 'Error');
      if (errorEl) {
        errorEl.textContent = message;
        errorEl.classList.add('show');
      }
    }

    // –°–∫—Ä—ã—Ç—å –æ—à–∏–±–∫—É
    function hideError(elementId) {
      const errorEl = document.getElementById(elementId + 'Error');
      if (errorEl) {
        errorEl.classList.remove('show');
      }
    }

    // –ü–æ–∫–∞–∑ —É—Å–ø–µ—Ö–∞
    function showSuccess(message) {
      const successEl = document.getElementById('successMessage');
      successEl.textContent = message;
      successEl.classList.add('show');
    }

    // –û—Å–Ω–æ–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
    document.addEventListener('DOMContentLoaded', function () {
      const form = document.getElementById('createBoardForm');
      const nameInput = document.getElementById('boardName');
      const descInput = document.getElementById('boardDescription');

      // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –≤–≤–æ–¥–µ
      nameInput.addEventListener('input', () => hideError('boardName'));
      descInput.addEventListener('input', () => hideError('boardDescription'));

      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
      form.addEventListener('submit', function (e) {
        e.preventDefault(); // üî• –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É

        // –°–±—Ä–æ—Å —Å–æ–æ–±—â–µ–Ω–∏–π
        hideError('boardName');
        hideError('boardDescription');
        document.getElementById('successMessage').classList.remove('show');

        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏ –æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        let name = nameInput.value.trim();
        const description = descInput.value.trim();

        // –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è
        if (!name) {
          showError('boardName', '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –¥–æ—Å–∫–∏.');
          return;
        }

        // –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
        name = name.toLowerCase();

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã
        if (name.length < 2 || name.length > 32) {
          showError('boardName', '–ù–∞–∑–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 2 –¥–æ 32 —Å–∏–º–≤–æ–ª–æ–≤.');
          return;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
        if (!/^[a-z0-9_-]+$/.test(name)) {
          showError('boardName', '–†–∞–∑—Ä–µ—à–µ–Ω—ã —Ç–æ–ª—å–∫–æ –ª–∞—Ç–∏–Ω—Å–∫–∏–µ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, –¥–µ—Ñ–∏—Å (-) –∏ –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–Ω–∏–µ (_).');
          return;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç
        const existingBoards = getBoards();
        const isDuplicate = existingBoards.some(board => board.name === name);
        if (isDuplicate) {
          showError('boardName', `–î–æ—Å–∫–∞ b/${name} —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.`);
          return;
        }

        // –ü–æ–ª—É—á–∞–µ–º –∞–≤—Ç–æ—Ä–∞ –∏–∑ —Å–µ—Å—Å–∏–∏
        let creator = 'anonymous';
        try {
          const sessionRaw = localStorage.getItem('fielsdown_session_v1');
          if (sessionRaw) {
            const session = JSON.parse(sessionRaw);
            if (session && session.isLoggedIn && session.username) {
              creator = session.username;
            }
          }
        } catch (e) {
          console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∞–≤—Ç–æ—Ä–∞');
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –¥–æ—Å–∫–∏
        const newBoard = {
          name: name,
          description: description || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è.',
          createdAt: new Date().toISOString(),
          creator: creator,
          postCount: 0
        };

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
        existingBoards.push(newBoard);
        saveBoards(existingBoards);

        // –£—Å–ø–µ—Ö
        showSuccess(`‚úÖ –î–æ—Å–∫–∞ b/${name} —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞!`);

        // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã
        nameInput.value = '';
        descInput.value = '';

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥
        setTimeout(() => {
          window.location.href = `/board.html?b=${encodeURIComponent(name)}`;
        }, 1200);
      });
    });
  </script>
</body>
</html>
